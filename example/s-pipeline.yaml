edition: 3.0.0
name: ai-model-app
access: quanxi

resources:
  modelDemo:
    component: fc3
    props:
      region: cn-shanghai
      runtime: custom-container
      functionName: ${env('fc_component_function_name', 'ai-model-test-qwen-pipeline')}  
      description: model service from functionai test
      logConfig: auto
      vpcConfig: auto
      nasConfig: auto
      instanceConcurrency: 20
      cpu: 8
      memorySize: 65536
      diskSize: 10240
      timeout: 300
      gpuConfig:
        gpuMemorySize: 49152
        gpuType: fc.gpu.ada.1
      customContainerConfig:
        image: >-
          serverless-registry.cn-hangzhou.cr.aliyuncs.com/functionai/modelscope:ubuntu22.04-cuda12.1.0-py311-torch2.3.1-tf2.16.1-1.26.0
        port: 9000
        entrypoint:
          - sh
          - '-c'
          - >-
            mkdir -p /.function_model && curl -fL --retry 3 -o
            /.function_model/server.py 
            https://images.devsapp.cn/modelscope/server.py &&  MODEL_ID="${env('MODEL_ID', 'iic/SenseVoiceSmall')}"  MODEL_VERSION="${env('MODEL_VERSION', 'master')}" MODEL_PATH="/mnt/${env('fc_component_function_name', 'ai-model-test-qwen-pipeline')} /${env('MODEL_ID', 'iic/SenseVoiceSmall')}"  TASK="${env('TASK')}" python3 -u /.function_model/server.py 
      triggers: # 默认，用户可能关注的是开启 authType 是 bear token
        - triggerConfig:
            methods:
              - GET
              - POST
              - PUT
              - DELETE
            authType: anonymous
            disableURLInternet: false
          triggerName: httpTrigger
          description: ''
          qualifier: LATEST
          triggerType: http
      provisionConfig:
        target: 1
        alwaysAllocateCPU: false
        alwaysAllocateGPU: false
        mode: sync

      annotations:
        modelConfig:
          source: modelscope
          id: ${env('MODEL_ID', 'iic/SenseVoiceSmall')}
          # id: Qwen/Qwen3-14B
          storage: nas
          role: acs:ram::${config('AccountID')}:role/aliyundevsdefaultrole
          
